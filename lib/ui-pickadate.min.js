!function(a,b){"function"==typeof define&&define.amd?define(["jquery","shadow","picker"],b):"object"==typeof exports?module.exports=b(require("jquery"),require("shadow"),require("picker")):a.Pickadate=b(a.$,a.shadow,a.Picker)}(this,function(a,b,c){"use strict";function d(a){return(a>9?"":"0")+a}function e(a,b){return!!a&&a.some(function(a){return"number"==typeof a?b.day===a:Array.isArray(a)?2==a.length?void console.log("TODO: check if date is within the range",a):b.compare(a):(console.log("TODO:",f.isTypeOf(a)),void console.log("Compare against:",a))})}var f=b._,g=f.el,h=a(document),i=b.Date.create.bind(b.Date),j={name:"Pickadate"};return j.add=function(a,b,c){this._super(a,b,function(a,b){return b.compare(a)},c)},j.attrs={min:null,max:null,today:null,view:null,highlight:null,select:null,disable:null,format:"d mmmm, yyyy",firstDay:null,show:null},j.classNames={host:" --pickadate",header:"box box--header",body:"box box--body",footer:"box box--footer",container:"container",buttonScope:"button button--scope",buttonPrev:"button button--prev",buttonNext:"button button--next",buttonToday:"button button--today",buttonClear:"button button--clear",buttonDisabled:"button--disabled",grid:"grid",gridTitle:"grid-title",gridCell:"grid-cell",disabled:"grid-cell--disabled",selected:"grid-cell--selected",highlighted:"grid-cell--highlighted",now:"grid-cell--now",infocus:"grid-cell--infocus",outfocus:"grid-cell--outfocus"},j.cloneLastSelection=function(a){var b=this,c=b.attrs;if(a=a||c.select,c.allowMultiple)console.log("todo"),console.log(c.select);else if(c.allowRange)return i(a[a.length-1]);return i(a)},j.cloneSelection=function(a){var b=this,c=b.attrs;return a=a||c.select,c.allowMultiple?void console.log("todo"):c.allowRange?a.map(i):i(a)},j.create=function(b){var c=this._super(b),d=c.attrs;return c.$host.on("mousedown."+c.id,"[data-select]",function(b){function e(a){g=a,d.select=c.getNewSelection(a,f)}b.preventDefault();var f=i(a(b.target).data("select")),g=f;d.select=c.getNewSelection(f);var j;c.$host.on("mouseenter."+c.id,"[data-select]",function(b){var c=i(a(b.target).data("select"));g.month!==c.month?void 0===j&&(j=setTimeout(function(){j=clearTimeout(j)},1e3),e(c)):g.compare(c)||e(c)}),h.on("mouseup."+c.id,function(a){c.$host.off("mouseenter."+c.id,"[data-select]"),h.off("mouseup."+c.id)})}),c.$host.on("click","[data-highlight]",function(b){var c=b.target,e=a(c).data("highlight");d.highlight=i(e),"years"==d.show?d.show="months":d.show=null}),c},j.dict={today:"Today",clear:"Clear",monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekNumberHeaderShort:"Wk",weekNumberHeaderFull:"Week number",weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},j.formats={d:function(a,b){return b?(a=a.match(/^\d{1,2}/))&&a[0]:a.date},dd:function(a,b){return b?(a=a.match(/^\d{1,2}/))&&a[0]:d(a.date)},ddd:function(a,b){if(b)return(a=a.match(/^\w+/))&&a[0];var c=i([a.year,a.month,a.date]);return this.dict.weekdaysShort[c.day]},dddd:function(a,b){if(b)return(a=a.match(/^\w+/))&&a[0];var c=i([a.year,a.month,a.date]);return this.dict.weekdaysFull[c.day]},m:function(a,b){return b?(a=a.match(/^\d{1,2}/))&&a[0]:a.month+1},mm:function(a,b){return b?(a=a.match(/^\d{1,2}/))&&a[0]:d(a.month+1)},mmm:function(a,b){return b?(a=a.match(/^\w+/))&&a[0]:this.dict.monthsShort[a.month]},mmmm:function(a,b){return b?(a=a.match(/^\w+/))&&a[0]:this.dict.monthsFull[a.month]},yyyy:function(a,b){return b?(a=a.match(/^\d{4}/))&&a[0]:a.year}},j.getNewAssignment=function(a){var b=this,c=b.attrs;return c.allowMultiple?b.getNewMultipleAssignment(a):c.allowRange?b.getNewRangeAssignment(a):i(a)},j.getNewMultipleAssignment=function(a){var b=this,c=b.attrs;if(!Array.isArray(a))throw new Error("To get multiple assignments, an array must be used.");return c.allowRange?a.map(function(a){return b.getNewRangeAssignment(a)}):a.map(i).sort(function(a,b){return a.compare("greater",b)?1:-1})},j.getNewMultipleSelection=function(a,b){var c=this,d=c.attrs;if(!d.allowMultiple)throw new Error("Multiple selections are not allowed.");if(d.select){var e=d.select.slice(0);if(d.allowRange){var g=e[e.length-1];if(b&&1===g.length&&b.compare(g[0]))return e[e.length-1]=[b,a],e;var h=c.getNewRangeSelection(a,b);if(b)return e[e.length-1]=h,e;for(var i=0;i<e.length;i++){var j=e[i];if(a.compareRange(j))return e}return console.log("todo:","check for overlapping ranges before pushing a new one"),e.push(h),e}var k=function(a,b){return b.compare(a)};return f.isWithin(e,a,k)?e:(e.push(a),e)}return d.allowRange?[[a]]:[a]},j.getNewRangeAssignment=function(a){if(a.length>2)throw new Error("A range can have a maximum of 2 dates; a lower and upper bound.");return a=a.map(i),1===a.length||a[0].compare(a[1])?[a[0]]:a.sort(function(a,b){return a.compare("greater",b)?1:-1})},j.getNewRangeSelection=function(a,b){var c=this,d=c.attrs;if(!d.allowRange)throw new Error("Range selections are not allowed.");return d.allowMultiple?d.select&&b?[b||d.select[d.select.length-1][0],a]:[a]:!d.select||!b&&2===d.select.length?[a]:[b||d.select[0],a]},j.getNewSelection=function(a,b){var c=this,d=c.attrs;return d.allowMultiple?c.getNewMultipleSelection(a,b):d.allowRange?c.getNewRangeSelection(a,b):a},j.isSelected=function(a,b){var c=this,d=c.attrs;if(!d.select)return!1;if(arguments.length<2&&(b=a,a=""),d.allowMultiple){if(d.allowRange){for(var e=0;e<d.select.length;e++){var g=d.select[e];if(i(b).compareRange(a,g))return!0}return!1}return f.isWithin(d.select,b,function(b,c){return c.compare(a,b)})}return d.allowRange?i(b).compareRange(a,d.select):d.select.compare(a,b)},j.isDisabled=function(a,b){var c=this,d=c.attrs;return arguments.length<2&&(b=a,a=""),b=i(b),!!e(d.disable,b)||!(!d.min.compare("greater",b)&&!d.max.compare("lesser",b))},j.nextEnabledDate=function(a){var c=this,d=c.attrs;f.isTypeOf(a,"date")?a=[a.getFullYear(),a.getMonth(),a.getDate()]:b.Date.isClassOf(a)&&(a=a.value),d.min.compare("greater",a)?a=d.min.value:d.max.compare("lesser",a)&&(a=d.max.value);var e=100,g=a[0],h=a[1],j=a[2],k=i([g,h,j]);for(h=(h+12)%12;e&&k.month!==h;){if(!e)throw"fell into infinite loop..";e-=1,j-=1,k=i([g,h,j])}return k},j.parse=function(a){var b=this,c=b._super(a);if(!c)return null;var d=b.attrs,e=b.dict,f=function(a){var b;if("mmmm"in a){if((b=e.monthsFull.indexOf(a.mmmm))<0)throw new Error("No month named “"+a.mmmm+"” found.")}else if("mmm"in a&&(b=e.monthsShort.indexOf(a.mmm))<0)throw new Error("No month named “"+a.mmm+"” found.");return[~~a.yyyy,void 0!==b?b:~~("mm"in a?a.mm:a.m)-1,~~("dd"in a?a.dd:a.d)]};return d.allowMultiple?void console.log("todo"):d.allowRange?c.map(f):f(c)},j.remove=function(a,b,c){this._super(a,b,function(a,b){return b.compare(a)},c)},j.setup=function(){var a=this,b=a.attrs;return a._super(),b.today=i(!0),b.min=i(b.min),b.max=i(b.max),b.select?(b.select=a.cloneSelection(),b.highlight=a.cloneLastSelection()):b.highlight?b.highlight=i(b.highlight):b.highlight=i(b.today),b.view?b.view=i(b.view,{setToTheFirst:!0}):b.view=i(b.highlight,{setToTheFirst:!0}),a.on("assign:select."+a.id,function(b){var c=b.value;c&&(b.value=a.getNewAssignment(c))}),a.on("assign:highlight."+a.id,function(b){var c=a.nextEnabledDate(b.value);b.value=i(c)}),a.on("assign:view."+a.id,function(a){var b=a.value;b=i(b),a.value=i([b.year,b.month,1])}),a.on("assign:min."+a.id+" assign:max."+a.id,function(a){a.value=i(a.value)}),a.on("set:highlight."+a.id,function(a){b.view=a.value}),a.on("set:select."+a.id,function(a){var c=a.value;if(c){if(b.allowMultiple&&b.allowRange){var d=c[c.length-1];c=d[d.length-1]}else(b.allowMultiple||b.allowRange)&&(c=c[c.length-1]);b.highlight=c}}),a.on("set:min."+a.id,function(a){b.highlight=b.highlight}),a.on("set:max."+a.id,function(a){b.highlight=b.highlight}),a.on("add:select."+a.id+" remove:select."+a.id,function(a){(b.allowMultiple||b.allowRange)&&(b.select=a.value.length?a.value:null)}),a},j.createHeader=function(){var a=this;return g({name:"header",klass:a.classNames.header},[a.createButtonScope(),a.createButtonNav(),a.createButtonNav("next")])},j.createBody=function(){var a=this;return g({klass:a.classNames.body,attrs:{tabIndex:0}},[a.createGrid(null,[a.createGridHeadDates(),a.createGridBodyDates()]),a.createGrid("months",[a.createGridHeadMonths(),a.createGridBodyMonths()]),a.createGrid("years",[a.createGridHeadYears(),a.createGridBodyYears()])])},j.createFooter=function(){var a=this,b=a.classNames;return g({name:"footer",klass:b.footer},[a.createButtonToday(),a.createButtonClear()])},j.createButtonNav=function(b){var c=this,d=c.attrs,e=c.classNames,f="next"==b,h=g({name:"button",klass:e[f?"buttonNext":"buttonPrev"],attrs:{type:"button"}}),i=function(){var a,b="years"==d.show?"decade":"months"==d.show?"year":"month";a=f?d.max.compare(b+" lesser equal",d.view):d.min.compare(b+" greater equal",d.view),a?(h.classList.add(e.buttonDisabled),h.disabled=!0):h.disabled&&(h.classList.remove(e.buttonDisabled),h.disabled=!1)};return i(),a(h).on("click",function(){var a=d.highlight.year,b=d.highlight.month,c=d.highlight.date,e=f?1:-1;"years"==d.show?a+=10*e:"months"==d.show?a+=e:b+=e,d.highlight=[a,b,c]}),c.on("set:view."+c.id,function(){i()}),c.on("set:show."+c.id,function(){i()}),h},j.createButtonScope=function(){var b=this,c=b.attrs,d=b.classNames,e=b.dict.monthsFull,f=function(){var a=c.view,b=a.year,d=a.month;return"years"==c.show?a.decade:"months"==c.show?b:e[d]+" "+b},h=g({name:"button",klass:d.buttonScope,attrs:{type:"button"}},f());return a(h).on("click",function(){c.show="years"==c.show?null:"months"==c.show?"years":"months"}),b.on("set:show."+b.id,function(){h.textContent=f()}),b.on("set:view."+b.id,function(a){var b=a.value,c=b.year,d=b.month,e=a.previousValue,g=e.year,i=e.month;c===g&&d===i||(h.textContent=f())}),h},j.createButtonToday=function(){var b=this,c=b.attrs,d=g({name:"button",klass:b.classNames.buttonToday,attrs:{type:"button"}},b.dict.today);return a(d).on("click",function(){c.highlight=c.today,c.show&&(c.show=null)}),d},j.createButtonClear=function(){var b=this,c=b.attrs,d=g({name:"button",klass:b.classNames.buttonClear,attrs:{type:"button"}},b.dict.clear);return a(d).on("click",function(){c.select=null,c.show&&(c.show=null)}),d},j.createGrid=function(b,c){b||(b=null);var d=this,e=d.attrs,f=d.classNames,h=function(a){i.hidden=a!==b},i=g(f.container,g({name:"table",klass:f.grid},c));return h(e.show),d.on("set:show."+d.id,function(a){h(a.value)}),d.on("set:select."+d.id,function(b){b.value||a(i).find("."+f.selected).removeClass(f.selected)}),i},j.createGridHeadYears=function(){var a=this,b=a.attrs.view,c=g({name:"th",attrs:{scope:"col",colspan:4}},b.decade),d=b.year;return a.on("set:view."+a.id,function(a){var b=a.value.year;b!==d&&(d=b,c.textContent=a.value.decade)}),g({name:"thead"},c)},j.createGridHeadMonths=function(){var a=this,b=a.attrs.view.year,c=g({name:"th",attrs:{scope:"col",colspan:4}},b);return a.on("set:view."+a.id,function(a){var d=a.value.year;d!==b&&(b=d,c.textContent=b)}),g({name:"thead"},c)},j.createGridHeadDates=function(){var a=this,b=a.classNames,c=a.attrs,d=a.dict,e=function(){var a=document.createDocumentFragment(),e=d.weekdaysShort.slice(0),f=d.weekdaysFull.slice(0);c.firstDay&&(e.push(e.shift()),f.push(f.shift()));for(var h=0;h<7;h++){var i=g({name:"th",klass:b.gridTitle,attrs:{scope:"col",title:f[h]}},e[h]);a.appendChild(i)}return a},f=function(){return g({name:"th",klass:b.gridTitle,attrs:{scope:"col",title:d.weekNumberHeaderFull}},d.weekNumberHeaderShort)},h=function(){var a=e();return c.showWeekNumbers&&a.insertBefore(f(),a.firstElementChild),a},i=g({name:"thead"},h());return a.on("set:firstDay."+a.id,function(){i.innerHTML="",i.appendChild(h())}),i},j.createGridBodyYears=function(){var a=this,b=a.attrs,c=a.classNames,d=function(d){var e=i([d,b.highlight.month,b.highlight.date]),f=e.time,h=b.min.compare("year greater",f)||b.max.compare("year lesser",f),j=g({name:"td",klass:c.gridCell+" "+(b.view.compare("decade",e)?c.infocus:c.outfocus)+(a.isSelected("year",f)?" "+c.selected:"")+(b.highlight.compare("year",f)?" "+c.highlighted:"")+(b.today.compare("year",f)?" "+c.now:"")+(h?" "+c.disabled:"")},d);return h||j.setAttribute("data-highlight",f),j},e=function(){for(var a=document.createDocumentFragment(),c=b.view.decade.start,e=0;e<3;e++){for(var f=g({name:"tr"}),h=0;h<4;h++){var i=h+4*e-1,j=d(c+i);f.appendChild(j)}a.appendChild(f)}return a},f=g({name:"tbody"},e());return a.on("set:view."+a.id,function(){f.innerHTML="",f.appendChild(e())}),f},j.createGridBodyMonths=function(){var a=this,b=a.classNames,c=a.attrs,d=a.dict,e=function(e){var f=[c.view.year,e,c.highlight.date],h=i(f);h.month!==e&&(h=a.nextEnabledDate(f));var j=h.time,k=c.min.compare("month greater",j)||c.max.compare("month lesser",j),l=d.monthsShort,m=g({name:"td",klass:b.gridCell+(a.isSelected("month",j)?" "+b.selected:"")+(c.highlight.compare("month",j)?" "+b.highlighted:"")+(c.today.compare("month",j)?" "+b.now:"")+(k?" "+b.disabled:"")},l[h.month]);return k||m.setAttribute("data-highlight",j),m},f=function(){for(var a=document.createDocumentFragment(),b=0;b<3;b++){for(var c=g({name:"tr"}),d=0;d<4;d++){var f=d+4*b,h=e(f);c.appendChild(h)}a.appendChild(c)}return a},h=g({name:"tbody"},f());return a.on("set:view."+a.id,function(){h.innerHTML="",h.appendChild(f())}),h},j.calculateWeekNumber=function(a,b,c){var d,e,f,g=this,h=g.attrs;return f=new Date(a,b,c+(h.firstDay?1:0)),d=new Date(a,0,1),e=Math.ceil(((f-d)/864e5+d.getDay()+1)/7),e>52&&(e=1),e},j.createGridBodyDates=function(){var a=this,b=a.attrs,c=a.classNames,d=function(b,d,e){return g({name:"th",klass:c.gridCell},a.calculateWeekNumber(b,d,e))},e=function(d,e,f){var h=i([d,e,f]),j=h.time,k=b.view.month===h.month,l=a.isDisabled(j),m=a.isSelected(j),n=b.highlight.compare(j),o=b.today.compare(j),p=g({name:"td",klass:c.gridCell+" "+(k?c.infocus:c.outfocus)+(l?" "+c.disabled:"")+(m?" "+c.selected:"")+(n?" "+c.highlighted:"")+(o?" "+c.now:"")},h.date);return l||p.setAttribute("data-select",j),p},f=function(a,c,f){var h,j=b.firstDay,k=i([a,c,1]).day,l=document.createDocumentFragment(),m=function(a,b,c){return 7*a+b-(c||0)};b.showWeekNumbers&&(h=m(f,1,k),l.appendChild(d(a,c,h)));for(var n=1;n<=7;n++)h=m(f,n,k),j&&(h+=1),l.appendChild(e(a,c,h));return g({name:"tr"},l)},h=function(){var a=b.view.year,c=b.view.month,d=b.firstDay,e=document.createDocumentFragment(),g=0;d&&0===i([a,c,1]).day&&(g=-1);for(var h=0;h<=5;h++)e.appendChild(f(a,c,h+g));return e},j=g({name:"tbody"},h()),k="set:view."+a.id+" set:firstDay."+a.id;return a.on(k,function(){j.innerHTML="",j.appendChild(h())}),j},j.template=function(){var a=this,b=a.content;return b.appendChild(a.createHeader()),b.appendChild(a.createBody()),b.appendChild(a.createFooter()),a._super()},j=c.extend(j)});